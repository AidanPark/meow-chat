version: "3.9"

services:
  backend-mcp:
    build:
      context: .
      dockerfile: backend/Dockerfile
      args:
        INSTALL_OCR_EXTRAS: "false"  # set to "true" to include OpenCV/PaddleOCR
    container_name: meowchat-backend-mcp
    environment:
      - DOCKER=1
      # Global defaults (optional)
      - MCP_HOST=${MCP_HOST:-0.0.0.0}
      - MCP_PORT=${MCP_PORT:-}
      # Per-server overrides
      - MCP_MATH_UTILITY_HOST=${MCP_MATH_UTILITY_HOST:-0.0.0.0}
      - MCP_MATH_UTILITY_PORT=${MCP_MATH_UTILITY_PORT:-8000}
      - MCP_WEATHER_API_HOST=${MCP_WEATHER_API_HOST:-0.0.0.0}
      - MCP_WEATHER_API_PORT=${MCP_WEATHER_API_PORT:-8001}
      - MCP_CAT_HEALTH_HOST=${MCP_CAT_HEALTH_HOST:-0.0.0.0}
      - MCP_CAT_HEALTH_PORT=${MCP_CAT_HEALTH_PORT:-8002}
      - MCP_OCR_API_HOST=${MCP_OCR_API_HOST:-0.0.0.0}
      - MCP_OCR_API_PORT=${MCP_OCR_API_PORT:-8003}
    ports:
      # Map host:container port using the same value so overrides stay in sync
      - "${MCP_MATH_UTILITY_PORT:-8000}:${MCP_MATH_UTILITY_PORT:-8000}"
      - "${MCP_WEATHER_API_PORT:-8001}:${MCP_WEATHER_API_PORT:-8001}"
      - "${MCP_CAT_HEALTH_PORT:-8002}:${MCP_CAT_HEALTH_PORT:-8002}"
      - "${MCP_OCR_API_PORT:-8003}:${MCP_OCR_API_PORT:-8003}"
    volumes:
      - ./:/workspace
    working_dir: /workspace
    restart: unless-stopped
