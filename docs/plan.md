# meow-chat 계획(간단 버전): 냥닥터

> **최종 업데이트**: 2026-01-02  
> **현재 목표**: Step 6(게이트)까지 최단 루트로 도달  
> **현재 상태**: Step 4.5(A+) MVP+ 최소범위 ✅ 완료

---

## 현재 진행 현황 (한눈에)

### ✅ 완료(Phase 1)
- Step 1~4: 스몰톡/세션 히스토리/문서 업로드+OCR/단일 Send UX
- Step 4.5(A): form 기반 단일 Send
- Step 4.5(A+) MVP+ 최소범위
  - ✅ 현재 문서 표시(기억 UX)
  - ✅ OCR 캐싱(키=`sha256(file_bytes):ocr_provider` + 캐시 히트 표시)
  - ✅ 단계 표시(업로드→OCR→의도분류→응답)
  - ✅ 스트리밍 저장 규칙(완료 후 최종 1개만 저장)
- 오케스트레이션 레이어(프레임워크 없이)
  - ✅ IntentClassifier(의도분류), Router, Responder 분리
  - ✅ 모델 분리: intent=gpt-5-nano, chat=gpt-5-mini, analysis=gpt-4.1

### ▶️ 다음(지금 할 일)
- **Step 4.x — 검사지 여러장 처리(최소 기능, 필수)**
  - 목표: 멀티페이지 PDF 또는 복수 이미지(2장 이상)의 OCR 결과를 합쳐서 분석 컨텍스트로 사용
  - 범위: UI/서빙까지 완성하지 않고, **노트북에서 파이프라인 유효성 검증** 중심으로 진행
  - 산출물(최소):
    - [ ] 노트북: "PDF 2페이지" 샘플로 전체 텍스트 병합→구조화→분석 프롬프트 입력까지 확인
    - [ ] 노트북: "이미지 2장" 샘플로 전체 텍스트 병합→구조화→분석 프롬프트 입력까지 확인
  - 메모: Streamlit 앱 반영은 Step 6 이후 Phase 2에서 진행(가능)

- **Step 5 — 검사 분석(문서 컨텍스트 기반 상담) 통과**
  - 실제 결과지 1~2장으로 “업로드→분석 질문→분석 답변” 확인

### ⏭️ Phase 2(1차 고도화로 이관)
- 재실행 버튼(질문만/OCR부터), ChatGPT급 첨부 UX
- 의도분류 고도화(멀티 라벨, confidence 기반 재질문, 툴 라우팅)
- 로그인/개인화 장기 기억 저장/조회
- 비동기 큐/멀티페이지 PDF

---

## Step 4.x — 검사지 여러장 처리(최소 기능, 필수)  ⏳

**목표**: 멀티페이지 PDF/복수 이미지(2장+)를 단일 "문서 컨텍스트"로 병합해 분석 가능하게 한다.

**추가 목표(최소 배포 요구: 모바일)**
- 파일첨부뿐 아니라, **모바일에서 갤러리 사진 선택 / 카메라 촬영 업로드**가 가능해야 한다.
  - 참고: `tests/streamlit_camera_demo.py`

**완료 조건(노트북/데모 검증으로 대체)**
- [ ] (PDF) 2페이지 이상에서 OCR 텍스트를 페이지 순서대로 병합
- [ ] (이미지) 2장 이상에서 OCR 텍스트를 병합
- [ ] 병합된 텍스트/구조화 결과가 분석 프롬프트 입력으로 사용 가능함을 확인
- [ ] (모바일 입력) 갤러리 선택/카메라 촬영 입력이 Streamlit에서 동작함을 확인
  - 데모 기준: `tests/streamlit_camera_demo.py` 동작 확인 + 결과를 앱 파이프라인 입력으로 연결 가능함을 확인

---

## Step 5 — 검사 분석(문서 컨텍스트 기반 상담)  ⏳

**목표**: 업로드된 검사 결과(ocr_text/structured)를 컨텍스트로 분석 답변 생성

**완료 조건(최단 루트)**
- [ ] 실제 결과지 1~2개에서 분석 요청 시 문서 컨텍스트가 답변에 반영
- [ ] 안전장치 유지(진단/처방 금지, 불확실성, 응급 시 병원 권유, 참고용 고지)

---

## Step 6 — (게이트) 프레임워크 도입 여부 결정  ⏳

> **형님 선택(A): 1인 개발/소규모 사용자 전제(당분간)**

**목표**: Phase 2에서 LangGraph/서빙 분리/DB/RAG 도입이 필요한지 Yes/No 결정

**선행 조건**
- [ ] Step 1~5 완료(특히 Step 5 실제 결과지 통과)

**타임박스**: 30~60분

**결정 질문(예/아니오 체크)**
- [ ] Streamlit ↔ API 분리가 지금 필요한가?
- [ ] 비동기(큐/백그라운드 작업)가 지금 필요한가?
- [ ] Phase 2에서 RAG(출처/검색)가 필요한가?
- [ ] LangGraph 같은 오케스트레이션이 지금 이득인가?
- [ ] 로그인/장기기억 저장이 곧 필요한가?

**산출물(5줄만 기록하면 끝)**
- 결론: Streamlit 유지 | API 분리 | API+Worker+Queue
- 오케스트레이션: Router 유지 | LangGraph 도입
- 저장/개인화: 세션만 | DB 도입
- RAG: 미도입 | 도입
- Phase 2 첫 3개 티켓

**기본 추천 결론(A 기준)**
- 당분간은 Streamlit 유지 + Router/서비스 레이어 확장

---

## 참고(설계 원칙 요약)
- UI(`app/`) ↔ 로직(`src/`) 분리 유지
- 외부 의존성(LLM/OCR)은 Provider 패턴으로 격리
- “검사지 1회 업로드 = 문서 컨텍스트 유지(기억 UX)”를 기본으로
